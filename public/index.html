<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket Thing1</title>
</head>
<style>
    .grid {
      display: table;
      border-spacing: 5px
    }
    .row {
      display: table-row
    }
    .cell {
      width: 50px;
      height: 50px;
      background: grey;
      display: table-cell;
    }
    .blue {
      background: rgb(34, 0, 255)
    }
    .green {
      background: rgb(9, 255, 30)
    }
    .green,.blue{
    text-align: center;
    vertical-align: middle;
    color: white;
    font-size: 40px;
    pointer-events: none;
}
</style>
<body>
    Client1
    <!-- <button onclick="sendMessage()">Send Msg</button> -->
    <div class="grid" id="grid">
        
    </div>

</body>
<script>
    // Create WebSocket connection.
    const socket = new WebSocket('ws://localhost:3000');

    // Connection opened
    socket.addEventListener('open', function (event) {
        console.log('Connected to WS Server');
    });

    // Listen for messages
    let myTurn = true;
    socket.addEventListener('message', function (event) {
        console.log('Message from server ', event.data);

        const obj = JSON.parse(event.data);
        console.log(obj,'obj');
        if(obj.type==1){
            window.localStorage.setItem('userId', obj.userId);
            window.localStorage.setItem('roomID', obj.roomID);
        }else if(obj.type==2){
            var element = document.getElementById('box'+obj.box_id);
            userId = window.localStorage.getItem('userId');
            if(obj.userId==userId){
                element.classList.add("green");
                element.innerHTML = "O";
                myTurn = false;
            }else{
                element.classList.add("blue");
                element.innerHTML = "X";
                myTurn = true;
            }
        }else{
            alert('Wait for opponent');
        }
        
        // alert('Message from server '+event.data);
    });

    const SetTarget = (id) => {
        if(myTurn == false){
            alert('Wait for opponent turn');
            return false;
        }
        const userId = window.localStorage.getItem('userId');
        const roomID = window.localStorage.getItem('roomID');
        socket.send(JSON.stringify({message:'Hello From Client1!',box_id:id,type:2,userId:userId,roomID:roomID}));
    }


</script>

<script>

    let box_i = 1;
    let boxes = '';
    for(let i=1;i<=3;i++){
        boxes += `<div class="row">`;
        for(let j=1;j<=3;j++,box_i++){
            boxes += `<div class="cell" id="box${box_i}" onclick="SetTarget(${box_i})"></div>`;
        }
        boxes += `</div>`;
    }
    document.getElementById('grid').innerHTML = boxes;

    
</script>
</html>